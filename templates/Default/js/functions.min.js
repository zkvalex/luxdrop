function live_drop() {
    live_drop_settimeout_id = setTimeout(live_drop, 1e3), $.ajax({
        type: "POST",
        url: "/engine/ajax/csgo/api.php",
        dataType: "json",
        data: {
            action: "live_drop",
            last_time: last_time
        },
        success: function (e) {
            last_time = e.last_time, $.each(e.live_drop, function (e, a) {
                "" != a && 0 == $("#live-drops [data-live-drop-id=" + e + "]").length && $("#live-drops").prepend(a);
                var t = parseInt($("#live-drops > li").length);
                if (t > 30) {
                    live_drop_diff = t - 16;
                    for (var o = 0; o < live_drop_diff; o++) $("#live-drops > li").eq("-" + o).remove()
                }
            })
        }
    })
}

function show_message(e, a) {
    a ? (class_error = " error", message_time = 3e3) : (class_error = "", message_time = 1500), clearTimeout(show_message_settimeout_id), $(".top-message").remove(), $("body").append('<div class="top-message' + class_error + '">' + e + ' <i class="message-close fa fa-times-circle"></i></div>'), $(".top-message").animate({
        top: "0px"
    }, 350), show_message_settimeout_id = setTimeout(function () {
        $(".top-message").stop().animate({
            top: "-80px"
        }, 250, function () {
            $(".top-message").remove()
        })
    }, message_time), $(".message-close").on("click", function () {
        $(".top-message").stop().animate({
            top: "-80px"
        }, 250, function () {
            $(".top-message").remove()
        })
    })
}

function modal_open(e) {
    $(".container, .slider, .live-drops, h1").addClass("blur"), $(".modal h1").removeClass("blur"), $(".modal").hide(), $(".modal-bg").show(), $(".modal-close").show(), $("body").addClass("hidden"), $("#" + e).show(), "modal-win" == e ? $(".modal-win-under").show() : "modal-payment" == e ? ($("#modal-payment #headers").show(), $("#modal-payment #not-enought-money").hide()) : "modal-coupon" == e && $("#modal-coupon input[name='coupon']").focus()
}

function modal_close() {
    return $(".modal").hide(), $(".modal-bg").hide(), $(".modal-win-under").hide(), $(".modal-close").hide(), $(".container, .slider, .live-drops, h1").removeClass("blur"), $(".modal h1").removeClass("blur"), $("body").removeClass("hidden"), !1
}

function change_sum(e) {
    var a = parseInt($(".user-page #balance-sum, #modal-payment #sum").val());
    $(".user-page #balance-sum, #modal-payment #sum").addClass("focused"), isNaN(a) && (a = 0), "+" == e ? a += 100 : "-" == e && (a -= 100) < 100 && (a = 100), $(".user-page #balance-sum, #modal-payment #sum").val(a), $(".user-page #balance-sum, #modal-payment #sum").trigger("change")
}

function new_timer(e) {
    return timer_id = setInterval(function () {
        time = $(e).html(), time_arr = time.split(":"), time_min = parseInt(time_arr[0]), time_sec = parseInt(time_arr[1]), time_min > 0 && time_sec > 0 && (time_sec -= 1), time_sec <= 0 && (time_sec = 59, time_min -= 1), time_min < 10 && (time_min = "0" + time_min), time_sec < 10 && (time_sec = "0" + time_sec), $(e).html(time_min + ":" + time_sec)
    }, 1e3), timer_id
}

function coupon_activate() {
    var e = $("#modal-coupon input[name='coupon']").val();
    $.ajax({
        type: "POST",
        url: "/engine/ajax/csgo/api.php",
        dataType: "json",
        data: {
            action: "coupon_activate",
            coupon: e
        },
        success: function (e) {
            "" != e.error ? ($("#modal-coupon #text-error").show(), $("#modal-coupon #text-success").hide(), "activated_before" == e.error ? $("#modal-coupon #text-error").text("Купон уже был активирован ранее") : "not_found" == e.error && $("#modal-coupon #text-error").text("Купон не найден или закончился срок его действия")) : ($("#user_balance, #profile_balance").text(e.balance), $("#modal-coupon #text-success").show(), $("#modal-coupon #text-error").hide(), $("#modal-coupon #text-success").text("Купон был успешно активирован"))
        }
    })
}

function open_case(e) {
    modal_close("modal-win"), clearTimeout(live_drop_settimeout_id);
    var a = $("#button_open_case").html(),
        t = ($("#modal_win_trial #open_case").text(), $("#button_open_case_free").text()),
        o = ($("#button_trial_open_case").text(), $("#button_trial_open_case").attr("disabled"));
    $("#button_open_case").text("Открываем..."), $("#button_open_case").attr("disabled", "disabled"), $("#button_open_case_free").text("Открываем..."), $("#button_open_case_free").attr("disabled", "disabled"), $("#button_trial_open_case").attr("disabled", "disabled"), $("#modal-win #weapon_image").attr("src", ""), $.ajax({
        type: "POST",
        url: "/engine/ajax/csgo/api.php",
        dataType: "json",
        data: {
            action: "open_case",
            url: e
        },
        success: function(e) {
            if ("" != e.error) "case_not_exist" == e.error ? window.location = "/" : "case_not_available" == e.error ? ($("#button_open_case").attr("disabled", "disabled"), $("#button_open_case").text("Кейс недоступен"), $("#button_open_case_free").attr("disabled", "disabled"), $("#button_open_case_free").text("Кейс недоступен")) : "no_authorization" == e.error ? window.location = "http://steam.luxdrop.ru/steam/?login" : "not_enough_money" == e.error && (modal_open("modal-payment"), $("#modal_payment_balance").text(e.balance), $("#modal-payment #sum").val(e.case_price), change_sum("+"), change_sum("-"), $("#modal-payment #headers").hide(), $("#modal-payment #not-enought-money").show(), $("#button_open_case_free").removeAttr("disabled"), $("#button_open_case_free").text(t), $("#button_open_case").removeAttr("disabled"), $("#button_open_case").html(a), "disabled" != o && $("#button_trial_open_case").removeAttr("disabled"));
            else {
                $("audio#case_open")[0].volume = .3, $("audio#case_open")[0].play(), $("#item-description").hide(), $("#items-random").fadeIn(500), win_item = parseInt(e.item_id);
                var i = jQuery.parseJSON(e.items);
                
                
                $.each(i, function(e, a) {
                
                    // Добавляем айтемы в прокрутку
                    item_id = parseInt(a.id);
                    $("#items-carousel .items").append('<li data-item-id="' + item_id + '"><div class="item item-' + a.type + '" data-item-id="' + item_id + '"><img src="' + a.image + '" alt="#"><div class="item-name"><h3>' + a.weapon + "</h3><h4>" + a.name + "</h4></div></div></li>")
                }), $("#modal-win").removeClass("item-classified item-rare item-covert item-restricted item-milspec item-uncommon"), $("#modal-win").addClass("item-" + e.weapon_type), $("#modal_win_trial #open_case").html('Открыть за <span id="case_price"></span> &#8381;'), !0 === e.is_free_n_case ? ($("#modal_win_trial #open_case").text("Открыть бесплатно"), $("#button_open_case_free").show(), $("#case_free_text").show(), $("#button_open_case").hide(), $("#button_open_case").hide(), $("#modal_win_trial #open_case").text("Открыть бесплатно")) : ($("#button_open_case").show(), $("#button_open_case_free").hide(), $("#case_free_text").hide()), $("#user_balance").text(e.balance), $("#modal-win #weapon_name").text(e.weapon_name), $("#modal-win #weapon_image").attr("src", e.weapon_image), $("#modal-win #weapon_price").text(e.weapon_price), $("#modal-win [data-item-sell]").attr("data-item-sell", e.drop_id), $("#modal-win [data-item-send]").attr("data-item-send", e.drop_id), $("#modal-win #item_send").show(), $("#modal-win #item_sended").hide(), $("#modal-win #item_sell").show(), $("#modal-win #item_sold").hide();
                var s = $("#items-carousel ul li").outerWidth(!0),
                    n = parseInt(e.win_slot) * s,
                    d = 0,
                    r = setInterval(function() {
                        var e = parseInt($("#items-carousel ul").css("left")) - 0,
                            a = Math.floor(e / s);
                        if (a !== d) {
                            var t = $("audio#case_scroll")[0];
                            t.volume = .3, t.pause(), t.currentTime = 0, t.play()
                        }
                        d = a
                    }, 10),
                    l = $("[data-change-speed].active").attr("data-change-speed");
                speed = "fast" == l ? 2500 : "medium" == l ? 4500 : 6e3, $("#items-carousel ul").css("left", "").animate({
                    left: "-=" + n
                }, speed, "easeOutQuad", function() {
                    $("audio#item_reveal")[0].play(), clearInterval(r), window.spinOn = !1, setTimeout(function() {
                        $("audio#item_reveal")[0].volume = .3, $("audio#item_reveal")[0].play(), $("#modal-win").find(".timer").html("59:59"), modal_open("modal-win"), last_timer_id = $("#modal-win[data-last-timer-id]").attr("data-last-timer-id"), "" != last_timer_id && clearInterval(last_timer_id), timer_id = new_timer($("#modal-win").find(".timer")), $("#modal-win[data-last-timer-id]").attr("data-last-timer-id", timer_id), $("#item-description").show(), $("#items-random").hide(), $("#items-carousel .items").html(""), $("#button_open_case").removeAttr("disabled"), $("#button_open_case").html(a), $("#button_open_case_free").removeAttr("disabled"), $("#button_open_case_free").text(t), "disabled" != o && $("#button_trial_open_case").removeAttr("disabled"), live_drop()
                    }, 500)
                })
            }
        }

    })
}

function rand(e, a) {
    return Math.floor(Math.random() * (a - e + 1)) + e
}

function unitpay() {
    var e = $("#balance-sum, #sum").val();
    $.ajax({
        type: "POST",
        url: "/engine/ajax/csgo/api.php",
        data: {
            action: "unitpay",
            sum: e
        },
        success: function (e) {
            "" != e && (window.location = e)
        }
    })
}

function skinpay() {
    $.ajax({
        type: "POST",
        url: "/engine/ajax/csgo/api.php",
        data: {
            action: "skinpay"
        },
        success: function (e) {
            "" != e && (window.location = e)
        }
    })
}

function open_free_case() {
    $.ajax({
        type: "POST",
        url: "/engine/ajax/csgo/api.php",
        dataType: "json",
        data: {
            action: "open_free_case"
        },
        success: function (e) {
            "" != e.error ? "no_authorization" == e.error ? window.location = "http://steam.luxdrop.ru/steam/?login" : "no_opened_cases" == e.error ? show_message("Для принятия участия в розыгрыше Вам необходимо открыть 1 кейс (не коллекцию) за последнюю неделю", !0) : "no_tradelink" == e.error && show_message('Необходимо указать ссылку на обмен в <a href="/user/' + user_url + '/">своем профиле</a>', !0) : (window.open("http://vk.com/share.php?url=https://luxdrop.ru/", "", "toolbar=0,status=0,width=626,height=436"), $("[data-button='open_free_case']").text("Регистрация пройдена").attr("disabled", "disabled"))
        }
    })
}
$(function () {
    function e() {
        var a = i.$Elmt.parentNode.clientWidth;
        a ? (a = Math.min(a, 1920), i.$ScaleWidth(a), i.$ScaleHeight(398)) : window.setTimeout(e, 30)
    }
    var a = $(".short-countdown").FlipClock({
        language: "ru-ru"
    });
    a.setTime(parseInt($(".short-countdown").attr("data-time"))), a.setCountdown(!0);
    var t = [
            [{
                b: 900,
                d: 2e3,
                x: -379,
                e: {
                    x: 7
                }
            }],
            [{
                b: 900,
                d: 2e3,
                x: -379,
                e: {
                    x: 7
                }
            }],
            [{
                b: -1,
                d: 1,
                o: -1,
                sX: 2,
                sY: 2
            }, {
                b: 0,
                d: 900,
                x: -171,
                y: -341,
                o: 1,
                sX: -2,
                sY: -2,
                e: {
                    x: 3,
                    y: 3,
                    sX: 3,
                    sY: 3
                }
            }, {
                b: 900,
                d: 1600,
                x: -283,
                o: -1,
                e: {
                    x: 16
                }
            }]
        ],
        o = {
            $AutoPlay: 1,
            $SlideDuration: 2e3,
            $SlideEasing: $Jease$.$OutQuint,
            $CaptionSliderOptions: {
                $Class: $JssorCaptionSlideo$,
                $Transitions: t
            },
            $ArrowNavigatorOptions: {
                $Class: $JssorArrowNavigator$
            }
        },
        i = new $JssorSlider$("slider", o);
    e(), $(window).bind("load", e), $(window).bind("resize", e), $(window).bind("orientationchange", e), $("a.btn.btn-disabled").attr("href", ""), $(".btn.btn-disabled").click(function () {
        return !1
    }), $(".live-drops").on("mouseenter", "ul li a", function () {
        $(this).parent().css({
            top: "-20px"
        }), $(this).parent().find(".live-drop-item").fadeIn(300)
    }).on("mouseleave", "ul li a", function () {
        $(this).parent().css({
            top: "0"
        }), $(this).parent().find(".live-drop-item").hide()
    }), $("[data-change-speed]").click(function () {
        $("[data-change-speed]").removeClass("active"), $(this).addClass("active")
    }), $(".cases .case").on("mouseenter", function () {
        $(this).css({
            top: "0px"
        })
    }).on("mouseleave", function () {
        $(this).css({
            top: "0"
        })
    }), $(".reviews .review .block-item img, .reviews .review .block-item-case").on("mouseenter", function () {
        $(this).parent().parent().find(".block-item-case").stop().fadeIn(250)
    }).on("mouseleave", function () {
        $(this).parent().parent().find(".block-item-case").stop().hide()
    }), $(".user-cases [data-drop-id] .timer").each(function () {
        new_timer($(this).find("span"))
    }), $("[data-item-sell]").on("click", function () {
        drop_id = parseInt($(this).attr("data-item-sell")), $.ajax({
            type: "POST",
            url: "/engine/ajax/csgo/api.php",
            dataType: "json",
            data: {
                action: "item_sell",
                drop_id: drop_id
            },
            success: function (e) {
                e.success && ($("[data-drop-id=" + drop_id + "] .button-send").remove(), $("[data-drop-id=" + drop_id + "] .button-sell").remove(), $("[data-drop-id=" + drop_id + "] .item-timer").remove(), $("[data-drop-id=" + drop_id + "] .button-sold").show(), $("#user_balance, #profile_balance").text(e.balance), $("#modal-win #item_send").hide(), $("#modal-win #item_sended").hide(), $("#modal-win #item_sell").hide(), $("#modal-win #item_sold").show(), $("[data-drop-id=" + drop_id + "] .timer").remove())
            }
        })
    }), $("[data-item-send]").on("click", function () {
        drop_id = parseInt($(this).attr("data-item-send")), $.ajax({
            type: "POST",
            url: "/engine/ajax/csgo/api.php",
            dataType: "json",
            data: {
                action: "item_send",
                drop_id: drop_id
            },
            success: function (e) {
                "no_tradelink" == e.error ? show_message('Для вывода предмета вам необходимо указать ссылку на обмен в <a href="/user/' + user_url + '/">своем профиле</a>', !0) : "no_payments" == e.error ? show_message("Для вывода предмета вам необходимо <a href=\"#\" onclick=\"modal_open( 'modal-payment' ); $('.modal-win-under').remove(); $('.top-message').remove(); return false;\">пополнить баланс</a> минимум на 40 рублей за последнюю неделю", !0) : e.success && ($("[data-drop-id=" + drop_id + "] .button-send").remove(), $("[data-drop-id=" + drop_id + "] .button-sell").remove(), $("[data-drop-id=" + drop_id + "] .item-timer").remove(), $("[data-drop-id=" + drop_id + "] .button-sended").show(), $("[data-drop-id=" + drop_id + "] .timer").remove(), $("#modal-win #item_send").hide(), $("#modal-win #item_sended").show(), $("#modal-win #item_sell").hide(), $("#modal-win #item_sold").hide())
            }
        })
    }), $("[data-save-trade-link]").on("click", function () {
        $.ajax({
            type: "POST",
            url: "/engine/ajax/csgo/api.php",
            dataType: "json",
            data: {
                action: "save_tradelink",
                tradelink: $("input[name='tradelink']").val()
            },
            success: function (e) {
                e.success ? show_message("Ссылка на обмен успешно сохранена") : ($("input[name='tradelink']").focus(), "tradelink_incorrect" == e.error ? show_message("Ссылка на обмен имеет неверный формат", !0) : "tradelink_empty" == e.error && show_message("Введите ссылку на обмен", !0))
            }
        })
    }), $("[data-save-email]").on("click", function () {
        $.ajax({
            type: "POST",
            url: "/engine/ajax/csgo/api.php",
            dataType: "json",
            data: {
                action: "save_email",
                email: $("input[name='email']").val()
            },
            success: function (e) {
                e.success ? show_message("E-Mail профиля успешно сохранен") : ($("input[name='email']").focus(), "email_incorrect" == e.error ? show_message("E-Mail адрес имеет неверный формат", !0) : "email_empty" == e.error ? show_message("Введите адрес E-Mail", !0) : "email_exists" == e.error && show_message("Пользователь с такими E-Mail адресом уже существует", !0))
            }
        })
    })
});
var live_drop_settimeout_id = 0,
    last_time = 0;
live_drop();
var show_message_settimeout_id = 0;
$(document).keyup(function (e) {
    27 == e.which && modal_close()
}), $(".modal-close, .modal-bg").click(function () {
    return modal_close(), !1
}), $("#balance-sum, #sum").on("keyup change", function () {
    $("#balance-sum, #sum").val($(this).val()), 0 == parseInt($(this).val()) ? $(".actions button[type='submit']").attr("disabled", "disabled") : $(".actions button[type='submit']").removeAttr("disabled")
});